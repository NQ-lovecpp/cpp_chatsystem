---
description: 项目架构概览、技术栈及编译部署指南 (C++ brpc 微服务 + React/Qt 前端)
globs: 
alwaysApply: true
---

# 项目核心指南

你是一个资深 C++ 开发者与架构师。在本项目中，除非特别指明，“前端”通常指 `ChatSystem-Frontend-React`。

## 1. 项目架构概览

### 后端 (ChatSystem-Backend)
基于 **brpc** 的微服务架构：
- **Gateway Server (7)**: 统一入口，处理 HTTP/WebSocket，负责鉴权与分发。
- **User Server (3)**: 用户管理 (MySQL/ODB + Redis)。
- **Friend Server (6)**: 好友关系与搜索。
- **Message Server (4, 5)**: 消息转发与持久化 (RabbitMQ + Elasticsearch)。
- **File/Speech Server (1, 2)**: 文件与语音处理。

**技术栈**: C++17, brpc, Protobuf, ODB, MySQL, Redis, etcd, RabbitMQ, Elasticsearch.

### 前端
- **React 端**: `ChatSystem-Frontend-React` (Vite + React + TailwindCSS)。
- **Qt 端**: `ChatSystem-Frontend-QtProj` (桌面客户端)。

## 2. 编译与构建流程

### 后端 CMake 编译
1. **顶层构建**: `ChatSystem-Backend/CMakeLists.txt` 驱动全局。
2. **子服务**: 各服务在 `build/` 下独立编译，自动生成 Protobuf 和 ODB 代码。

```bash
cd ChatSystem-Backend && mkdir -p build && cd build && cmake .. && make -j$(nproc)
```

### Docker 部署
1. **依赖收集**: 运行 `./depends.sh` 拷贝动态库到 `build/depends`。
2. **启动**: 使用 `docker-compose up --build -d` 启动基础设施与业务服务。

### 前端 (React)
```bash
cd ChatSystem-Frontend-React && npm install && npm run dev
```

## 3. 交互规范
- 只在用户明确需要时，才在工作区添加 `.md` 文档进行说明。
- 优先保持代码风格一致，遵循 C++17 标准与 React 最佳实践。

## 4. 功能完成后的自主测试规范
- 在实现功能后，默认应进行可执行的自主验证，而不是仅停留在静态代码分析。
- 对前端改动，优先进行页面级验证：可启动本地前端并通过浏览器操作检查关键交互、状态变化与报错信息。
- 需要快速验证逻辑时，可在浏览器环境执行最小必要的 JavaScript（如读取 DOM、触发事件、校验渲染结果）。
- 涉及接口联调时，可自主发起请求（含 POST）验证行为；优先使用测试账号、测试数据或本地环境，避免污染生产数据。
- 未经用户明确授权，不得对生产环境执行高风险写操作；如目标环境不明确，应先确认再执行。
- 测试结束后，需在回复中简要说明：测试步骤、实际结果、失败点（如有）与建议的下一步。
